/*!
 *
 *  Web Starter Kit
 *  Copyright 2014 Google Inc. All rights reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License
 *
 */
function generateTimelineHTML(e){var t=getDate(e[e.length-2].split(",")[DATE_INDEX]);t.setHours(12);for(var n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a=0,s=t,r="";s<=Date.now();){a++;var o=new Date(s.getTime());o.setDate(o.getDate()+1),s.getMonth()!==o.getMonth()&&(r+='<td colspan="'+a+'">'+n[s.getMonth()]+" "+s.getFullYear()+"</td>",a=0),s=o}r+='<td colspan="'+(a+1)+'">'+n[s.getMonth()]+" "+s.getFullYear()+"</td>",document.querySelector("#releasesTable thead tr.date").innerHTML+=r}function generateReleasesHTML(e){for(var t={},n=void 0,a=[],s=e.length-2;s>0;s--){var r=e[s].split(",");if(-1!==CHANNELS.indexOf(r[CHANNEL_INDEX])){var o=r[BOARD_INDEX],l=getDate(r[DATE_INDEX]);t[o]||(t[o]={},t[o].channels={},t[o].channelsHTML={"dev-channel":[],"beta-channel":[],"stable-channel":[]},n=n||l),t[o].deviceName=r[DEVICE_INDEX],t[o].releaseDate=l,t[o].startDate=t[o].startDate||n;var i=getDateRange(t[o].startDate,t[o].releaseDate);if(i>-1){for(var d in t[o].channelsHTML)t[o].channels[d]||t[o].channelsHTML[d].push("<td>&nbsp;</td>");t[o].channels={}}for(var c=0;i>c;c++)for(var d in t[o].channelsHTML)t[o].channelsHTML[d].push("<td>&nbsp;</td>");var d=r[CHANNEL_INDEX],u=parseInt(r[VERSION_INDEX].substr(0,2)),f='<td class="'+d+'" data-version="'+r[VERSION_INDEX]+'" data-platform="'+r[PLATFORM_INDEX]+'" data-milestone="'+u+'" data-date="'+l.toDateString()+'" ></td>';if(t[o].channels[d]){var m=t[o].channelsHTML[d].length-1;t[o].channelsHTML[d][m]=f}else t[o].channelsHTML[d].push(f);previousMilestone=a.length>0?a[a.length-1].version:0,u&&u>previousMilestone&&a.push({version:u,date:l}),t[o].channels[d]=!0,t[o].startDate=t[o].releaseDate}}displayReleases(t),displayMilestones(a)}function displayReleases(e){var t="",n="";for(device in e)t+="<tr><td>"+prettify(e[device].deviceName)+"</td></tr><tr></tr>",n+="<tr>"+e[device].channelsHTML["dev-channel"].join("")+"</tr><tr>"+e[device].channelsHTML["beta-channel"].join("")+"</tr><tr>"+e[device].channelsHTML["stable-channel"].join("")+"</tr><tr></tr>";document.querySelector("#devicesTable tbody").innerHTML+=t,document.querySelector("#releasesTable tbody").innerHTML+=n}function displayMilestones(e){for(var t="",n=0;n<e.length;n++){n===e.length-1?(endDate=new Date,endDate.setDate(endDate.getDate()+2)):endDate=e[n+1].date;var a="M"+e[n].version;t+="<td colspan="+(getDateRange(e[n].date,endDate)+1)+'><span alt="Click to highlight '+a+' updates" title="Click to highlight '+a+' updates">'+a+"</span></td>"}var s='<div class="in"></div>',r=document.querySelector("tr.milestone");r.innerHTML+=t+s,r.addEventListener("mousewheel",function(e){document.body.scrollLeft-=e.wheelDelta}),r.addEventListener("click",function(e){if("SPAN"===e.target.nodeName){e.target.classList.toggle("checked"),document.querySelectorAll(".checked").length>0?document.querySelector("#releasesTable tbody").classList.add("dim"):document.querySelector("#releasesTable tbody").classList.remove("dim");for(var t=e.target.textContent.substr(1),n=document.querySelectorAll('[data-milestone="'+t+'"]'),a=0;a<n.length;a++)n[a].classList.toggle("hl")}})}function setupBubble(){document.querySelector("#releasesTable").addEventListener("mouseover",function(e){var t=document.querySelector(".bubble");if(!e.target.dataset.version)return t.style.display="none",void 0;t.innerHTML='<a target="_blank" href="//www.google.com/search?q=site:http://googlechromereleases.blogspot.com%20'+e.target.dataset.version+'">'+e.target.dataset.version+" - "+e.target.dataset.platform+"</a><span>"+e.target.dataset.date+"<span>";var n=document.querySelector("#releasesTable");t.style.display="block",t.style.position="absolute",t.style.left=n.offsetLeft+e.target.offsetLeft-90-e.target.offsetWidth+4+"px",t.style.top=n.offsetTop+e.target.offsetTop+e.target.offsetHeight+3+"px"});var e=document.querySelector("#legend");e.style.display="block",e.addEventListener("mouseover",function(e){var t=document.querySelector(".bubble");return e.target.dataset.version?(t.innerHTML='<a href="#">version - platform</a><span>date<span>',t.style.left=e.target.offsetLeft-5+"px",t.style.top=e.target.offsetTop+108+"px",t.style.display="block",t.style.position="fixed",void 0):(t.style.display="none",void 0)})}function setupArrows(){var e=0,t=null,n=document.querySelector(".arrows");n.style.display="block",n.addEventListener("mouseover",function(n){e=parseInt(n.target.dataset.offset)||0,function a(){document.body.scrollLeft+=e,t=requestAnimationFrame(a)}()}),n.addEventListener("mouseout",function(){cancelAnimationFrame(t)}),n.addEventListener("mousedown",function(){e=5*e}),n.addEventListener("mouseup",function(){e/=5})}function getDateRange(e,t){var n=new Date(e.getTime());n.setHours(12),n.setDate(n.getDate()+1);var a=new Date(t.getTime());a.setHours(12);var s=864e5;return Math.round((a.getTime()-n.getTime())/s)}function prettify(e){switch(e){case"Google Chromebook Pixel":return"Chromebook Pixel";case"Samsung Series 5 - He":return"Samsung Series 5";case"Acer AC700 - He":return"Acer AC700";default:return e}}function getDate(e){return new Date(e.substr(0,4),parseInt(e.substr(5,2))-1,e.substr(8,2),e.substr(11,2),e.substr(14,2),e.substr(17,2),e.substr(20,3))}!function(){"use strict";function e(){s.classList.remove("open"),r.classList.remove("open"),a.classList.remove("open")}function t(){s.classList.toggle("open"),r.classList.toggle("open"),a.classList.toggle("open"),a.classList.add("opened")}var n=document.querySelector.bind(document),a=n(".navdrawer-container"),s=document.body,r=n(".app-bar"),o=n(".menu"),l=n("main");l.addEventListener("click",e),o.addEventListener("click",t),a.addEventListener("click",function(t){("A"===t.target.nodeName||"LI"===t.target.nodeName)&&e()})}();var DATE_INDEX=0,PLATFORM_INDEX=1,VERSION_INDEX=2,BOARD_INDEX=3,CHANNEL_INDEX=4,DEVICE_INDEX=5,CHANNELS=["dev-channel","beta-channel","stable-channel"];window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.mozRequestAnimationFrame}(),window.cancelAnimationFrame=function(){return window.cancelAnimationFrame||window.mozCancelAnimationFrame}();var xhr=new XMLHttpRequest;xhr.open("GET","historyBIG.csv"),xhr.onload=function(){if(4===xhr.readyState&&200===xhr.status){var e=xhr.responseText.split("\n");generateTimelineHTML(e),generateReleasesHTML(e),setupBubble(),setupArrows()}},xhr.send(),$(document).ready(function(){function e(e,t,n){var a="translate("+t+"px,"+n+"px)";e.css({transform:a,"-ms-transform":a,"-webkit-transform":a,"-o-transform":a,"-moz-transform":a})}$(document).scroll(function(){if($("#releasesTable").size()>0){var t=$(window).scrollTop()-$("#releasesTable thead.top").offset().top;window.console&&console.log("delta: "+t),t>-190?e($("#releasesTable thead.top tr"),0,t+190):e($("#releasesTable thead.top tr"),0,0)}if($("#devicesTable").size()>0){var t=$(window).scrollLeft()-$("#devicesTable tbody.side").offset().left;window.console&&console.log("delta: "+t),t>0?e($("#devicesTable tbody.side tr"),t,0):e($("#devicesTable tbody.side tr"),0,0)}})});